<h1>Video Library</h1>

<div id="searchbar">
	<%= form_tag 'library', :method => 'get' do %>
		<%= text_field_tag :search, params[:search], size: 55, :placeholder => 'Find videos by title, keyword, or descripton contents.' %>
		<%= submit_tag "Search", :name => nil %>  
	<% end %>
</div>

<div id="albums_bar">
	<% if @album %>
		<div class="album_button"><%= link_to 'All', 'library', html_options = {:class => "album"}%></div>
	<% else %>
		<div class="album_button_active"><%= link_to 'All', 'library', html_options = {:class => "album"}%></div>
	<% end %>

		<% @albums.each do |album| %>	
			<% if album == @album %>
				<div class="album_button_active" id="<%= album + '_btn' %>"><%= link_to album.truncate(33, separator: ' '), 'library?album='.concat(album), html_options = {:class => "album"}%></div>
			<% else %>
				<div class="album_button" id="<%= album + '_btn' %>"><%= link_to album.truncate(33, separator: ' '), 'library?album='.concat(album), html_options = {:class => "album"}%></div>
			<% end %>

		<% end %>
</div>



<ul class="library"> 

<% @videos.each do |video| %>

<li class="library">
	<h2 class="expanded_title"><%= video.name %></h2>
	<div class="video_thumbnail" id="<%=video.vid%>">
		<%= link_to(image_tag("playbutton.png", :class => "playbutton"), :controller => "pages", :action => "video", :vid => video.vid, :name => video.name, :remote => true) %>
		<%= image_tag video.thumb, :class => "vid_thumbnail" %>
	</div>

	<h2 class="vid_title"><%= video.name %></h2>
	<p class="vid_description"><%= raw(video.description) %></p>

	<span class="expandbtn"><%= link_to "Show More", :controller => "pages", :action => "video", :vid => video.vid, :name => video.name, :remote => true %></span>

	<span class="collapsebtn"><%= link_to "Show Less", :controller => "pages", :action => "close_video", :vid => video.vid, :name => video.name, :thumb => video.thumb, :remote => true %></span>

</li>

<% end %>

</ul>



<script>

$(document).ready(function() {
	//highlight appropriate nav tab
	$("li[rel$='library']").toggleClass("nav_button nav_button_active");

	//album button rollover effect
	$(".album_button").mouseenter(function() {
	  $(this).css({"background":"linear-gradient(#FFFFFF, #F0F0F0)"});
	}).mouseleave(function() {
	  $(this).css({"background":"linear-gradient(#F8F8F8, #E0E0E0)"});
	});

	//play button rollover effects
	$(".video_thumbnail").mouseenter(function() { //highlight playbutton on hover
		$(this).find(".playbutton").css({"opacity":"0.6"});
	}).mouseleave(function() { 
		$(this).find(".playbutton").css({"opacity":"0.4"});
	}).click(function() { //expand video & description on click
	  var vidblock = $(this).closest("li");
	  expand_vid(vidblock);
	});

	//expand video & description
	$(".expandbtn").click(function() { 
	  var vidblock = $(this).closest("li");
	  expand_vid(vidblock);
	});

	//collapse video & description
	$(".collapsebtn").click(function() { 
	  var vidblock = $(this).closest("li");
	  collapse_vid(vidblock);
	});

});


function expand_vid(vidblock) {
	vidblock.css({"animation":"vid_rolldown 1s", "height":"auto", "background":"linear-gradient(#B0B0B0, #888888)", "color":"#F0F0F0", "box-shadow":"0px 0px 4px 3px #333"});
	vidblock.find("p").css({"height":"auto", "margin":"0px 50px 0px 50px"});
	vidblock.find(".vid_title").hide();
	vidblock.find(".expanded_title").show();
	vidblock.find(".collapsebtn").css({"display":"block"});
	vidblock.find(".expandbtn").css({"display":"none"});
	vidblock.find("div").css({"width":"100%"});
	vidblock.scrollView();
};

function collapse_vid(vidblock) {
	vidblock.find("iframe").hide();
	vidblock.find("p").css({"height":"10em", "margin":""});
	vidblock.find(".vid_title").show();
	vidblock.find(".expanded_title").hide();
	vidblock.find(".expandbtn").css({"display":"inline"});
	vidblock.find(".collapsebtn").css({"display":"none"});
	//vidblock.css({"animation":"vid_rollup 1s"});
	vidblock.css({"animation":"vid_rollup 0.7s", "height":"200px", "background":"transparent", "color":"", "box-shadow":""});
	vidblock.find("div").css({"width":""});
	vidblock.scrollView();
};

$.fn.scrollView = function() {
	return this.each(function() {
		$("html, body").animate( {
			scrollTop: $(this).offset().top - 50
		}, 600);
	});
};

</script>
